<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù…Ø¹ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap');
body{font-family:Arial,sans-serif;background:#f4f4f4;margin:0;padding:0;direction:rtl}
.hero{position:relative;height:260px;background-image:url('heroimage.jpg'),url('https://images.unsplash.com/photo-1519817650390-64a93db51149?auto=format&fit=crop&q=80&w=1200');background-size:cover;background-position:center;display:flex;justify-content:center;align-items:center;color:#fff;text-align:center}
.hero::before{content:"";position:absolute;inset:0;background:rgba(0,0,0,0.55)}
.hero-content{position:relative;z-index:2}
.hero h1{font-size:2.4rem;margin:0}
.app-container{max-width:900px;background:#fff;margin:20px auto;border-radius:12px;padding:20px;box-shadow:0 6px 22px rgba(0,0,0,0.06)}
select{width:100%;padding:12px;font-size:18px;border:1px solid #ccc;border-radius:6px;background:#fff;margin-bottom:12px;text-align:center;appearance:none}
.ayah-row{display:flex;align-items:center;gap:8px}
.ayah-row select{flex:1;margin-bottom:0}
#ayah-decrement,#ayah-increment{width:108px;height:42px;font-size:20px;border:none;border-radius:8px;background:#1976d2;color:#fff;cursor:pointer}
#ayah-decrement:disabled,#ayah-increment:disabled{background:#9aa6bf;cursor:not-allowed}
.font-controls{display:flex;justify-content:center;align-items:center;gap:10px;margin:14px 0}
.font-controls button{padding:8px 14px;font-size:16px;background:#1976d2;color:#fff;border:none;border-radius:6px;cursor:pointer}
#font-size-label{color:#333}
.quran-text-card{border:1px solid #e6e9ef;border-radius:10px;background:#fff;padding:16px;margin-bottom:16px}
.tab-buttons{display:flex;border-bottom:1px solid #e6e9ef;margin-bottom:16px}
.tab-button{padding:10px 20px;cursor:pointer;border:none;background:transparent;font-size:16px;color:#333;border-bottom:2px solid transparent;margin-bottom:-1px}
.tab-button.active{color:#1976d2;border-bottom-color:#1976d2;font-weight:600}
.tab-pane{display:none}
.tab-pane.active{display:block}
.quran-text{direction:rtl;text-align:right;font-family:'Scheherazade New',serif;font-size:16px;line-height:2;word-wrap:break-word}
.translations{direction:ltr;text-align:left;font-size:16px;color:#222}
#urdu{border-top:1px solid #eee;margin-top:12px;padding-top:12px}
.chips-section{margin-top:20px}
.chips-title{text-align:center;font-size:16px;font-weight:600;color:#333;margin-bottom:12px}
.chips-container{display:flex;overflow-x:auto;gap:8px;padding:0 8px;scrollbar-width:none}
.chips-container::-webkit-scrollbar{display:none}
.chip{display:inline-flex;align-items:center;background:#f1f3f4;border:1px solid #dadce0;border-radius:20px;padding:8px 16px;font-size:14px;color:#3c4043;white-space:nowrap;transition:all .15s;cursor:pointer}
.chip:hover{background:#e8f0fe;color:#1a73e8;border-color:#1a73e8}
.chip.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.tafsir-content-box{margin-top:12px;padding:14px;border-radius:8px;background:#fafafa;border:1px solid #eee;line-height:1.7;font-size:16px;color:#222;min-height:64px;position:relative}
.tafsir-header{font-weight:700;margin-bottom:8px;font-size:17px;color:#222}
.copy-btn{position:absolute;top:12px;left:12px;background:#1976d2;color:#fff;border:none;padding:6px 10px;border-radius:6px;font-size:13px;cursor:pointer}
.copy-btn:hover{background:#125ab2}
.status{text-align:center;color:#b00020;font-size:14px;margin-top:8px}
audio{width:100%;margin-top:10px}
#loop-container{display:flex;align-items:center;gap:8px;justify-content:center;margin:10px 0;font-size:15px}
#reciter-info{text-align:center;font-size:15px;color:#333;margin-top:8px;display:none}
body.dark-mode{background:#121212;color:#e0e0e0}
body.dark-mode .app-container{background:#1e1e1e;box-shadow:0 6px 22px rgba(255,255,255,0.06)}
body.dark-mode select{background:#2c2c2c;color:#e0e0e0;border-color:#444}
body.dark-mode #ayah-decrement,body.dark-mode #ayah-increment,body.dark-mode .font-controls button,body.dark-mode .copy-btn{background:#0d47a1}
body.dark-mode #ayah-decrement:disabled,body.dark-mode #ayah-increment:disabled{background:#555}
body.dark-mode #font-size-label{color:#e0e0e0}
body.dark-mode .quran-text-card{background:#2c2c2c;border-color:#444}
body.dark-mode .tab-buttons{border-bottom-color:#444}
body.dark-mode .tab-button{color:#e0e0e0}
body.dark-mode .tab-button.active{color:#1a73e8;border-bottom-color:#1a73e8}
body.dark-mode .translations{color:#e0e0e0}
body.dark-mode #urdu{border-top-color:#444}
body.dark-mode .chips-title{color:#e0e0e0}
body.dark-mode .chip{background:#333;color:#e0e0e0;border-color:#555}
body.dark-mode .chip:hover{background:#444;color:#1a73e8;border-color:#1a73e8}
body.dark-mode .chip.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
body.dark-mode .tafsir-content-box{background:#2c2c2c;border-color:#444;color:#e0e0e0}
body.dark-mode .tafsir-header{color:#e0e0e0}
body.dark-mode label[for="play-next10"]{color:#e0e0e0}
body.dark-mode #reciter-info{color:#e0e0e0}
</style>
</head>
<body>

<div class="hero">
  <div class="hero-content">
    <h1>Ù…Ø¹ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
    <p>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ§Ù„ØªÙ„Ø§ÙˆØ© ÙˆØ§Ù„ØªÙØ³ÙŠØ±</p>
  </div>
</div>

<div class="app-container">
  <select id="surah-select"><option value="">Ø¥Ø®ØªØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</option></select>

  <div class="ayah-row">
    <button id="ayah-increment" disabled>+</button>
    <button id="ayah-decrement" disabled>-</button>
    <select id="ayah-select" disabled><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¢ÙŠØ©</option></select>
  </div>

  <div class="font-controls">
    <button id="font-smaller">A-</button>
    <button id="font-bigger">A+</button>
    <span id="font-size-label">16px</span>
    <button id="dark-mode-toggle">ğŸŒ™</button>
  </div>

  <div class="quran-text-card">
    <div class="tab-buttons">
      <button class="tab-button active" data-tab="ayah">Ø§Ù„Ø¢ÙŠØ©</button>
      <button class="tab-button" data-tab="translation">Ø§Ù„ØªØ±Ø¬Ù…Ø©</button>
      <button class="tab-button" data-tab="search">Ø¨Ø­Ø«</button>
    </div>
    <div class="tab-content">
      <div id="ayah" class="tab-pane active">
        <div id="arabic-text" class="quran-text"></div>
      </div>
      <div id="translation" class="tab-pane">
        <div class="translations"><div id="english"></div><div id="urdu"></div></div>
      </div>
      <div id="search" class="tab-pane">
        <iframe src="search.html" style="width: 100%; height: 500px; border: none;"></iframe>
      </div>
    </div>
  </div>

  <div id="loop-container">
    <input type="checkbox" id="play-next10">
    <label for="play-next10">ØªÙ„Ø§ÙˆØ© Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ø¹Ø´Ø±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø£Ùˆ Ø¥Ù„Ù‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±Ø©</label>
  </div>

  <div class="chips-section">
    <div class="chips-title">Ø¥Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦</div>
    <div class="chips-container" id="reciters-container">
      <div class="chip reciter-chip" data-id="1" data-name="Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„ÙØ§Ø±Ø³ÙŠ">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„ÙØ§Ø±Ø³ÙŠ</div>
      <div class="chip reciter-chip" data-id="2" data-name="Ø§Ø¨ÙˆØ¨ÙƒØ± Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ">Ø§Ø¨ÙˆØ¨ÙƒØ± Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ</div>
      <div class="chip reciter-chip" data-id="3" data-name="Ù†Ø§ØµØ± Ø§Ù„Ù‚ØªÙ…ÙŠ">Ù†Ø§ØµØ± Ø§Ù„Ù‚ØªÙ…ÙŠ</div>
      <div class="chip reciter-chip" data-id="4" data-name="ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ">ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ</div>
      <div class="chip reciter-chip" data-id="5" data-name="Ù‡Ø§Ù†Ù‰ Ø§Ù„Ø±ÙØ§Ø¹ÙŠ">Ù‡Ø§Ù†Ù‰ Ø§Ù„Ø±ÙØ§Ø¹ÙŠ</div>
    </div>
  </div>

  <div id="reciter-info"></div>
  <audio id="audio-player" controls style="display:none"></audio>

  <div class="chips-section">
    <div class="chips-title">Ø¥Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙØ³ÙŠØ±</div>
    <div class="chips-container" id="tafsir-authors"></div>

    <div id="tafsir-text" class="tafsir-content-box">
      <div id="tafsir-header" class="tafsir-header"></div>
      <button class="copy-btn" id="copy-tafsir">ğŸ“‹ Ù†Ø³Ø®</button>
      <div id="tafsir-body">Ø§Ø®ØªØ± Ù…Ø¤Ù„ÙØ§ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ³ÙŠØ± Ù‡Ù†Ø§..</div>
    </div>
  </div>

  <div class="status" id="status"></div>
</div>

<script>
const proxy = "https://old-band-312d.yabaggi.workers.dev/?quest=";
const SURAH_URL='https://quranapi.pages.dev/api/surah.json';
const surahSelect=document.getElementById('surah-select');
const ayahSelect=document.getElementById('ayah-select');
const ayahDec=document.getElementById('ayah-decrement');
const ayahInc=document.getElementById('ayah-increment');
const arabicEl=document.getElementById('arabic-text');
const englishEl=document.getElementById('english');
const urduEl=document.getElementById('urdu');
const tafsirAuthorsEl=document.getElementById('tafsir-authors');
const tafsirHeader=document.getElementById('tafsir-header');
const tafsirBody=document.getElementById('tafsir-body');
const copyBtn=document.getElementById('copy-tafsir');
const audioPlayer=document.getElementById('audio-player');
const playNext10=document.getElementById('play-next10');
const statusEl=document.getElementById('status');
const reciterInfo=document.getElementById('reciter-info');

let currentAudioData=null,selectedReciterId=null,selectedReciterName='',currentFontSize=16,ibnKathirId=null,surahNames=[],totalAyahs=0;
let isSequentialPlaying=false,stopSequential=false;

async function fetchJSON(u){const r=await fetch(u);if(!r.ok)throw new Error(r.status);return r.json();}

async function loadSurahs(){
  const d=await fetchJSON(SURAH_URL);
  surahNames=d.map(x=>x.surahNameArabic);
  d.forEach((s,i)=>{const o=document.createElement('option');o.value=i+1;o.textContent=`${i+1}. ${s.surahNameArabic}`;surahSelect.appendChild(o);});
}

async function loadTafsirAuthors(){
  try{
    const arr=await fetchJSON(proxy + 'http://api.quran-tafseer.com/tafseer/');
    const filtered=arr.filter(a=>a.language==='ar'||a.language==='en');
    const order=['ØªÙØ³ÙŠØ± Ø§Ù„Ø¬Ù„Ø§Ù„ÙŠÙ†','ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±','Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±','ØªÙØ³ÙŠØ± Ø§Ù„Ø³Ø¹Ø¯ÙŠ'];
    const prioritized=[],rest=[];
    filtered.forEach(a=>{if(order.includes(a.name.trim()))prioritized.push(a);else rest.push(a);});
    prioritized.sort((a,b)=>order.indexOf(a.name.trim())-order.indexOf(b.name.trim()));
    const finalList=[...prioritized,...rest];
    tafsirAuthorsEl.innerHTML='';
    finalList.forEach(a=>{
      const chip=document.createElement('div');
      chip.className='chip tafsir-chip';
      chip.textContent=a.name;
      chip.dataset.id=a.id;
      chip.addEventListener('click',()=>selectTafsir(a.id,a.name,chip));
      tafsirAuthorsEl.appendChild(chip);
      if(a.name.trim()==='ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±')ibnKathirId=a.id;
    });
  }catch(e){
    tafsirAuthorsEl.innerHTML='<div style="color:#888;text-align:center;padding:10px">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ³Ø±ÙŠÙ†</div>';
  }
}

surahSelect.addEventListener('change',async()=>{
 const s=parseInt(surahSelect.value);if(!s)return;
 const meta=await fetchJSON(`https://quranapi.pages.dev/api/${s}/1.json`);
 totalAyahs=meta.totalAyah;ayahSelect.innerHTML='';
 for(let i=1;i<=totalAyahs;i++){const o=document.createElement('option');o.value=i;o.textContent=i;ayahSelect.appendChild(o);}
 ayahSelect.disabled=false;ayahSelect.value=1;updateAyahButtons();loadAyah();
});

ayahSelect.addEventListener('change',()=>{loadAyah();updateAyahButtons();});
ayahDec.onclick=()=>{let v=parseInt(ayahSelect.value);if(v>1){ayahSelect.value=v-1;loadAyah();}updateAyahButtons();};
ayahInc.onclick=()=>{let v=parseInt(ayahSelect.value);const m=ayahSelect.options.length;if(v<m){ayahSelect.value=v+1;loadAyah();}updateAyahButtons();};
function updateAyahButtons(){const a=parseInt(ayahSelect.value),m=ayahSelect.options.length;ayahDec.disabled=a<=1;ayahInc.disabled=a>=m;}

async function loadAyah(){
 const s=parseInt(surahSelect.value),a=parseInt(ayahSelect.value);
 if(!s||!a)return;
 const d=await fetchJSON(`https://quranapi.pages.dev/api/${s}/${a}.json`);
 arabicEl.textContent=d.arabic1||'';englishEl.textContent=d.english||'';urduEl.textContent=d.urdu||'';currentAudioData=d.audio||null;
 if(ibnKathirId) loadIbnKathir(s,a);
}

async function loadIbnKathir(surah,ayah){
 tafsirHeader.textContent=`ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ± (${surahNames[surah-1]} â€“ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© ${ayah})`;
 tafsirBody.textContent='...Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ³ÙŠØ±';
 document.querySelectorAll('.tafsir-chip').forEach(c=>c.classList.remove('active'));
 const ibnChip=[...document.querySelectorAll('.tafsir-chip')].find(c=>c.textContent.trim()==='ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±');
 if(ibnChip) ibnChip.classList.add('active');
 const d=await fetchJSON(proxy + `http://api.quran-tafseer.com/tafseer/${ibnKathirId}/${surah}/${ayah}`);
 tafsirBody.textContent=d.text||'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙØ³ÙŠØ± Ø§Ø¨Ù† ÙƒØ«ÙŠØ±';
}

copyBtn.onclick=()=>{const title=tafsirHeader.textContent.trim(),text=tafsirBody.textContent.trim();if(!text)return;navigator.clipboard.writeText(`${title}\n\n${text}`).then(()=>{copyBtn.textContent='âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®';setTimeout(()=>copyBtn.textContent='ğŸ“‹ Ù†Ø³Ø®',2000);});};

document.getElementById('font-bigger').onclick=()=>{currentFontSize=Math.min(60,currentFontSize+2);arabicEl.style.fontSize=currentFontSize+'px';document.getElementById('font-size-label').textContent=currentFontSize+'px';};
document.getElementById('font-smaller').onclick=()=>{currentFontSize=Math.max(14,currentFontSize-2);arabicEl.style.fontSize=currentFontSize+'px';document.getElementById('font-size-label').textContent=currentFontSize+'px';};

document.querySelectorAll('.reciter-chip').forEach(c=>{
 c.addEventListener('click',async()=>{
  if(isSequentialPlaying){stopSequential=true;await new Promise(r=>setTimeout(r,300));}
  document.querySelectorAll('.reciter-chip').forEach(x=>x.classList.remove('active'));
  c.classList.add('active');
  selectedReciterId=c.dataset.id;selectedReciterName=c.dataset.name;
  reciterInfo.textContent=`Ø§Ù„ØªÙ„Ø§ÙˆØ© Ø¨ØµÙˆØª Ø§Ù„Ù‚Ø§Ø±Ø¦ ${selectedReciterName}`;
  reciterInfo.style.display='block';
  if(!currentAudioData){statusEl.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØª';return;}
  stopSequential=false;
  if(playNext10.checked){isSequentialPlaying=true;await playSequentialAyahs(selectedReciterId);isSequentialPlaying=false;}
  else playSingleAyah(selectedReciterId);
 });
});

playNext10.addEventListener('change',()=>{if(!playNext10.checked&&isSequentialPlaying){stopSequential=true;audioPlayer.pause();isSequentialPlaying=false;reciterInfo.style.display='none';}});

function playSingleAyah(recId){
 const val=currentAudioData[recId];
 if(val&&val.url){audioPlayer.src=val.url;audioPlayer.style.display='block';audioPlayer.play().catch(()=>{});}
 else statusEl.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙˆØª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø§Ø±Ø¦';
}

async function playSequentialAyahs(recId){
 const s=parseInt(surahSelect.value),a=parseInt(ayahSelect.value);
 let start=a,end=Math.min(a+9,totalAyahs);
 for(let n=start;n<=end;n++){if(stopSequential){reciterInfo.style.display='none';return;}
 ayahSelect.value=n;await loadAyah();const data=await fetchJSON(`https://quranapi.pages.dev/api/${s}/${n}.json`);
 const aud=data.audio;if(!aud)break;const v=aud[recId];
 if(v&&v.url){audioPlayer.src=v.url;audioPlayer.style.display='block';try{await audioPlayer.play();}catch{}await new Promise(res=>audioPlayer.onended=res);}else break;}
 reciterInfo.style.display='none';
}

async function selectTafsir(id,name,chip){
 const s=parseInt(surahSelect.value),a=parseInt(ayahSelect.value);
 if(!s||!a){tafsirBody.textContent='Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹';return;}
 document.querySelectorAll('.tafsir-chip').forEach(c=>c.classList.remove('active'));chip.classList.add('active');
 tafsirHeader.textContent=`${name} (${surahNames[s-1]} â€“ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© ${a})`;tafsirBody.textContent='...Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„';
 const d=await fetchJSON(proxy + `http://api.quran-tafseer.com/tafseer/${id}/${s}/${a}`);tafsirBody.textContent=d.text||'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ³ÙŠØ±';
}

loadSurahs();loadTafsirAuthors();

const darkModeToggle = document.getElementById('dark-mode-toggle');
darkModeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  if (document.body.classList.contains('dark-mode')) {
    localStorage.setItem('darkMode', 'enabled');
  } else {
    localStorage.setItem('darkMode', 'disabled');
  }
});

if (localStorage.getItem('darkMode') !== 'disabled') {
  document.body.classList.add('dark-mode');
}

window.addEventListener('storage', (event) => {
  if (event.key === 'darkMode') {
    if (event.newValue === 'enabled') {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }
});

const tabButtons = document.querySelectorAll('.tab-button');
const tabPanes = document.querySelectorAll('.tab-pane');

tabButtons.forEach(button => {
  button.addEventListener('click', () => {
    tabButtons.forEach(btn => btn.classList.remove('active'));
    tabPanes.forEach(pane => pane.classList.remove('active'));

    button.classList.add('active');
    const tabId = button.dataset.tab;
    document.getElementById(tabId).classList.add('active');
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 1. Get the hero element from the page
  const heroElement = document.querySelector('.hero');

  // 2. Read the 'img' parameter from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const imgBasename = urlParams.get('kKr');

  // 3. If the 'img' parameter is present, try to load the image
  if (imgBasename) {
    const selectedImage = imgBasename + '.jpg';
    
    // 4. Update the background-image style
    // This keeps your original fallback image as well.
    // The browser will try to load the selectedImage. If it fails (404),
    // it may show nothing for that layer, but the fallback will still be there.
    heroElement.style.backgroundImage = `url('${selectedImage}'), url('https://images.unsplash.com/photo-1519817650390-64a93db51149?auto=format&fit=crop&q=80&w=1200')`;
  }
  // If no 'img' parameter is found, the page will simply
  // use the default image already defined in your CSS.
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Media Browser</title>
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#2196f3">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Simple Media">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
</head>
<body>
    <header>
        <h1>Simple Media Browser</h1>
    </header>
    <main>
        <div class="hero">
            <div class="hero-content">
                <h2>Search for openly-licensed images and audio</h2>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Enter your search query...">
                    <div class="search-buttons">
                        <button id="search-images">Search Images</button>
                        <button id="search-audio">Search Audio</button>
                    </div>
                    <div class="filters-container">
                        <div class="filter-group">
                            <label for="license-type">License Type:</label>
                            <select id="license-type">
                                <option value="">All</option>
                                <option value="commercial">Commercial</option>
                                <option value="modification">Modification</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="source">Source:</label>
                            <select id="source">
                                <option value="">All</option>
                                <option value="jamendo">Jamendo</option>
                                <option value="wikimedia">Wikimedia</option>
                                <option value="flickr">Flickr</option>
                                <option value="stocksnap">StockSnap</option>
                            </select>
                        </div>
                        <div class="filter-group" id="image-category-filter">
                            <label for="image-category">Image Category:</label>
                            <select id="image-category">
                                <option value="">All</option>
                                <option value="photograph">Photograph</option>
                                <option value="illustration">Illustration</option>
                                <option value="digitized_artwork">Digitized Artwork</option>
                            </select>
                        </div>
                        <div class="filter-group" id="audio-category-filter" style="display: none;">
                            <label for="audio-category">Audio Category:</label>
                            <select id="audio-category">
                                <option value="">All</option>
                                <option value="music">Music</option>
                                <option value="sound_effect">Sound Effect</option>
                                <option value="podcast">Podcast</option>
                                <option value="audiobook">Audiobook</option>
                                <option value="news">News</option>
                                <option value="pronunciation">Pronunciation</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="advice-widget">
            <h2>Advice of the Day</h2>
            <div id="advice-container">
                <p>Loading...</p>
            </div>
        </div>
        <div id="results-container" class="results-container"></div>
        <div class="pagination-container">
            <button id="load-more" style="display: none;">Load More</button>
        </div>
    </main>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    <script src="script.js"></script>

    <script>
        // PWA Service Worker Registration
        // Generated by PWA Converter v2.0.1
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Use RELATIVE path for service worker (works with multi-app setup)
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('‚úì Service Worker registered:', registration.scope);
                        console.log('‚úì Service Worker URL:', registration.active ? registration.active.scriptURL : 'installing...');
                        console.log('‚úì App: Simple Media Browser');
                        console.log('‚úì Folder: openverse');
                        console.log('‚úì Total files cached: 7'); // +3 for manifest, sw, offline
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute
                    })
                    .catch(error => {
                        console.error('‚úó Service Worker registration failed:', error);
                    });
            });
        } else {
            console.warn('‚ö† Service Workers not supported in this browser');
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üí° PWA install prompt available');
            // Show custom install UI
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // You can implement custom install UI here
            console.log('üì± App can be installed - Click browser menu or use custom UI');
        }

        // Install PWA function (call from your custom install button)
        async function installPWA() {
            if (!deferredPrompt) {
                console.log('‚ùå Install prompt not available');
                return;
            }
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to install prompt: ${outcome}`);
            deferredPrompt = null;
        }

        // Track installation
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA installed successfully!');
            console.log('‚úÖ App: Simple Media Browser');
            console.log('‚úÖ App ID: openverse-id');
            console.log('‚úÖ Folder: openverse');
            deferredPrompt = null;
        });

        // Display mode detection
        function getPWADisplayMode() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            if (document.referrer.startsWith('android-app://')) {
                return 'twa';
            } else if (navigator.standalone || isStandalone) {
                return 'standalone';
            }
            return 'browser';
        }

        const displayMode = getPWADisplayMode();
        console.log('üñ•Ô∏è Display mode:', displayMode);
        
        // Log PWA configuration
        console.log('‚öôÔ∏è PWA Configuration:');
        console.log('  - App Name: Simple Media Browser');
        console.log('  - App ID: openverse-id');
        console.log('  - Start URL: /openverse/');
        console.log('  - Scope: /openverse/');
        console.log('  - Folder: openverse');
        console.log('  - Files included: 4');
    </script>
</body>
</html>